@model GigHub.ViewModels.GigsDetailViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

    <div class="detail">
        <span class="artist-name">@Model.Gig.Artist.Name</span>
        @if (User.Identity.IsAuthenticated)
        {
            if (Model.IsFollowingGigArtist)
            {

                <span class="badge follow-link">Following</span>
            }
            else
            {
                <span class=""><a data-artist-id="@Model.Gig.ArtistId" class="js-toggle-follow" href="#">Follow</a></span>
            }
        }

        <p>Performing at @Model.Gig.Venue on @Model.Gig.DateTime.ToShortDateString() @Model.Gig.DateTime.ToShortTimeString()</p>

        @if (User.Identity.IsAuthenticated)
        {
            if (Model.IsAttendingGig)
            {
                <p>You are going to this event</p>
            }
            else
            {
                <p>You are not going to this event</p>
            }
        }

    </div>

<div>
    @Html.ActionLink("Back to Gigs", "Index", "Home", null, new { @class = "btn btn-primary" })
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            $(".js-toggle-follow").click(function (e) {
                e.preventDefault();
                var link = $(e.target)
                console.log(link.attr("data-artist-id"));

                $.post("/api/followings", { FolloweeId: link.attr("data-artist-id") })
                    .done(function () {
                        link
                            .addClass('badge follow-link')
                            .text("Following");
                    })
                    .fail(function () {
                        alert("something failed")
                    })
            })
        });;
    </script>
}